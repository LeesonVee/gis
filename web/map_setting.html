<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="css/element.css">
    <!-- 引入组件库 -->
    <script type="text/javascript" src="js/vue.min.js"></script>
    <script src="js/element.js"></script>
    <link rel="stylesheet" href="css/bootstrap.css" type="text/css">
    <script src="js/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="js/ajaxrequestasync.js"></script>
    <script type="text/javascript" src="js/ajaxrequestsync.js"></script>
    <script type="text/javascript" src="js/config.js"></script>
    <script src="js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/ol.css" type="text/css">
    <script src="js/ol.js"></script>
    <script src="js/map.js"></script>
    <style>
        #app {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /*background-color: #000;*/
        }
        .el-container{
            width:100%;
            height:100%;
        }
        .my-el-main{
            color:#333;
            text-align:center;
            width:100%;
            height:100%;
            padding: 0px;
            margin: 0px;
        }

        .el-footer {
            background-color: #B3C0D1;
            color: #333;
            text-align: center;
            line-height: 60px;
        }
        .el-header {
            background-color: #B3C0D1;
            color: #333;
            line-height: 60px;
        }
        .row_background{
            background: #f0f9eb;
        }
        .float_dialog{
            position: absolute;
            width:200px;
            z-index:11;
            color: red;
            font-weight: bold;
            background: rgba(88, 131, 226, 0.2);
        }
    </style>
</head>
<body>
<div id="app">
    <div v-if="floatDialog" id="floatDialog" class="float_dialog" :style="{top:floatDialogTop+'px',left:floatDialogLeft+'px'}">
        <div v-for="item in floatDialogData">
            <el-col :span="8" style="text-align: right;">{{item.name}}:</el-col>
            <el-col :span="16">{{item.val}}</el-col>
        </div>
    </div>
    <el-container>
        <el-main class="my-el-main">
            <div :id="form.target" style="width: 100%;height: 100%;"></div>
        </el-main>
        <el-aside width="400px">
            <el-container>
                <el-main class="my-el-main">
                    <el-form ref="form" :model="form" :rules="rules" label-width="100px" style="margin: 10px 2px 0px 0px;">
                        <el-tabs v-model="activeName">
                            <el-tab-pane label="基础设置" name="systemBase">
                                <el-form-item label="地图名称" prop="name">
                                    <el-input v-model="form.name"></el-input>
                                </el-form-item>
                                <el-form-item label="渲染元素" prop="target">
                                    <el-input v-model="form.target" @change="targetChange" onkeyup="this.value=this.value.replace(/[^\w\.\/]/ig,'');"></el-input>
                                </el-form-item>
                                <el-form-item label="显示级别" prop="levels" style="text-align: left;">
                                    <el-select v-model="form.levels"  placeholder="请选择最大显示级别" @change="areaCodeLevelsChange">
                                        <el-option label="省级" value="province"></el-option>
                                        <el-option label="市级" value="city"></el-option>
                                        <el-option label="区级" value="district"></el-option>
                                        <el-option label="街道" value="street"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="行政区划" required>
                                    <div>
                                        <el-col :span="8">
                                            <el-form-item prop="province">
                                                <el-select v-model="form.province"  placeholder="请选择" @change="areaCodeChange('province')">
                                                    <!--<el-option label="广东省" value="440000"></el-option>-->
                                                    <el-option v-for="item in provinceOption" :key="item.AREA_CODE" :label="item.AREA_CODE_NAME" :value="item.AREA_CODE"></el-option>
                                                </el-select>
                                            </el-form-item>
                                        </el-col>
                                    </div>
                                    <div v-if="form.levels!=='province'">
                                        <el-col class="line" :span="1">-</el-col>
                                        <el-col :span="7">
                                            <el-form-item prop="city">
                                                <el-select v-model="form.city"  placeholder="请选择" @change="areaCodeChange('city')">
                                                    <!--<el-option label="广州市" value="440100"></el-option>-->
                                                    <el-option v-for="item in cityOption" :key="item.AREA_CODE" :label="item.AREA_CODE_NAME" :value="item.AREA_CODE"></el-option>
                                                </el-select>
                                            </el-form-item>
                                        </el-col>
                                    </div>
                                    <div v-if="form.levels == 'district' || form.levels == 'street'">
                                        <el-col class="line" :span="1">-</el-col>
                                        <el-col :span="7">
                                            <el-form-item prop="district">
                                                <el-select v-model="form.district" placeholder="请选择" @change="areaCodeChange('district')">
                                                    <!--<el-option label="天河区" value="440106"></el-option>-->
                                                    <el-option v-for="item in districtOption" :key="item.AREA_CODE" :label="item.AREA_CODE_NAME" :value="item.AREA_CODE"></el-option>
                                                </el-select>
                                            </el-form-item>
                                        </el-col>
                                    </div>
                                </el-form-item>
                                <el-form-item label="中心经纬度" required>
                                    <el-col :span="11">
                                        <el-form-item prop="lng">
                                            <el-input v-model="form.lng" onkeyup="this.value=this.value.replace(/[^\d.]/g,'');"></el-input>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="2"> - </el-col>
                                    <el-col :span="11">
                                        <el-form-item prop="lat">
                                            <el-input v-model="form.lat" onkeyup="this.value=this.value.replace(/[^\d.]/g,'');"></el-input>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="缩放级别" prop="zoom" style="text-align: left">
                                    <el-select v-model="form.zoom" placeholder="请选择">
                                        <el-option v-for="item in zooms" :key="item.value" :label="item.label" :value="item.value"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="地图编码" style="text-align: left;">
                                    <el-select v-model="form.projection">
                                        <el-option label="标准编码" value="EPSG:4326"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="离线地图" style="text-align: left;">
                                    <div>
                                        <el-col :span="24">
                                            <el-radio-group v-model="form.otherMap">
                                                <el-radio :label="0">不加载</el-radio>
                                                <el-radio :label="1">加载</el-radio>
                                            </el-radio-group>
                                        </el-col>
                                    </div>
                                    <div v-if="form.otherMap==1">
                                        <el-col :span="24">
                                            <el-form-item prop="mapType">
                                                <el-select v-model="form.mapType" placeholder="请选择">
                                                    <el-option label="高德地图" value="amap"></el-option>
                                                    <!--<el-option label="百度地图" value="baidu"></el-option>-->
                                                </el-select>
                                            </el-form-item>
                                        </el-col>
                                    </div>
                                </el-form-item>
                                <el-form-item label="添加事件" style="text-align: left;">
                                    <el-checkbox-group v-model="form.events">
                                        <el-checkbox label="singleclick" key="singleclick">单击</el-checkbox>
                                        <el-checkbox label="pointermove" key="pointermove">鼠标滑过</el-checkbox>
                                        <el-checkbox label="moveend" key="moveend">缩放</el-checkbox>
                                    </el-checkbox-group>
                                </el-form-item>
                                <el-form-item style="text-align: left;">

                                    <el-button @click="resetForm('form')">重置</el-button>
                                </el-form-item>
                            </el-tab-pane>
                            <el-tab-pane label="样式设置" name="systemStyle">
                                <el-form-item label="背景颜色" style="text-align: left;">
                                    <el-color-picker v-model="form.fillColor" show-alpha></el-color-picker>
                                </el-form-item>
                                <el-form-item label="区域颜色" style="text-align: left;">
                                    <el-color-picker v-model="form.areaColor" show-alpha></el-color-picker>
                                </el-form-item>
                                <el-form-item label="线条样式" style="text-align: left;">
                                    <el-col :span="4">
                                        <el-form-item>
                                            <el-color-picker v-model="form.areaStrokeColor" show-alpha></el-color-picker>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="4">
                                        <el-form-item>
                                            <el-input-number size="small" v-model="form.areaStrokeWidth" :min="2" :max="10"></el-input-number>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                            </el-tab-pane>
                            <el-tab-pane label="数据绑定" name="bindData">
                                <el-row style="text-align: left;font-weight: bold;font-size: 18px;cursor: pointer;">
                                    <el-col :span="24">
                                        <div @click="choiceModelClick"><icon class="el-icon-connection" style="color: rgb(51, 122, 183);"></icon>&nbsp;&nbsp;{{choiceModelName}}</div>
                                    </el-col>
                                </el-row>
                                <div v-show="!modelDataChoice">
                                    <el-row>
                                        <div @click="choiceModelClick">
                                            <el-col :span="24">
                                                <table class="table table-bordered" id="datamodeltable"  style="table-layout: fixed;word-break: break-all;text-align: center">
                                                    <thead>
                                                    <tr><td width="15%">序号</td><td style="display: none">ID</td><td>名称</td></tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr v-for="(item, index) in models" v-cloak  @click="dealModelData('dataModel',item,$event)" style="cursor: pointer">
                                                        <td>{{index+1}}</td>
                                                        <td style="display: none">{{item.ID}}</td>
                                                        <td>{{item.CN_NAME}}</td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </el-col>
                                        </div>

                                    </el-row>
                                    <el-row>
                                        <el-col :span="24">
                                            <el-pagination
                                                    @current-change="handleCurrentChange"
                                                    :current-page.sync="currentPage"
                                                    :page-size="pageSize"
                                                    :prev-text="prevText"
                                                    :next-text="nextText"
                                                    layout="prev,next,jumper"
                                                    :total="totalCount">
                                            </el-pagination>
                                        </el-col>
                                    </el-row>
                                </div>
                                <div v-show="modelDataChoice">
                                    <el-collapse v-model="activeDatas">
                                        <el-collapse-item title="散点图" name="1">
                                            <el-row>
                                                <el-col :span="24">
                                                    <div style="margin: 5px;text-align: left;font-size: 30px;color: #3a8ee6;">
                                                        <i title="添加" class="el-icon-circle-plus" @click="openWin('1','add')"></i>
                                                    </div>
                                                </el-col>
                                            </el-row>
                                            <el-row>
                                                <el-table :data="marksHeadData" border style="width: 100%" size="mini" max-height="350">
                                                    <el-table-column prop="MODEL_RELATION_NAME" label="名称" width="220"></el-table-column>
                                                    <el-table-column label="样式设置">
                                                        <template slot-scope="scope">
                                                            <el-button @click="showMarks(scope.$index,scope.row,'1')" type="text" size="small">显示</el-button>
                                                            <el-button @click="modifyClick(scope.$index,scope.row,'1')" type="text" size="small">修改</el-button>
                                                            <el-button @click="delModelRelation(scope.$index,scope.row,'1')" type="text" size="small">删除</el-button>
                                                        </template>
                                                    </el-table-column>
                                                </el-table>
                                            </el-row>
                                        </el-collapse-item>
                                        <el-collapse-item title="热力图" name="2">
                                            <el-row>
                                                <el-col :span="24">
                                                    <div style="margin: 5px;text-align: left;font-size: 30px;color: #3a8ee6;">
                                                        <i title="添加" class="el-icon-circle-plus" @click="openWin('2','add')"></i>
                                                    </div>
                                                </el-col>
                                            </el-row>
                                            <el-row>
                                                <el-table :data="hotMapData" border style="width: 100%" size="mini" max-height="350">
                                                    <el-table-column prop="MODEL_RELATION_NAME" label="名称" width="220"></el-table-column>
                                                    <el-table-column label="样式设置">
                                                        <template slot-scope="scope">
                                                            <el-button @click="showMarks(scope.$index,scope.row,'2')" type="text" size="small">显示</el-button>
                                                            <el-button @click="modifyClick(scope.$index,scope.row,'2')" type="text" size="small">修改</el-button>
                                                            <el-button @click="delModelRelation(scope.$index,scope.row,'2')" type="text" size="small">删除</el-button>
                                                        </template>
                                                    </el-table-column>
                                                </el-table>
                                            </el-row>
                                        </el-collapse-item>
                                        <el-collapse-item title="标注" name="3">
                                            <el-row>
                                                <el-col :span="24">
                                                    <div style="margin: 5px;text-align: left;font-size: 30px;color: #3a8ee6;">
                                                        <i title="添加" class="el-icon-circle-plus" @click="openWin('3','add')"></i>
                                                    </div>
                                                </el-col>
                                            </el-row>
                                            <el-row>
                                                <el-table :data="lableMapData" border style="width: 100%" size="mini" max-height="350">
                                                    <el-table-column prop="MODEL_RELATION_NAME" label="名称" width="220"></el-table-column>
                                                    <el-table-column label="样式设置">
                                                        <template slot-scope="scope">
                                                            <el-button @click="showMarks(scope.$index,scope.row,'3')" type="text" size="small">显示</el-button>
                                                            <el-button @click="modifyClick(scope.$index,scope.row,'3')" type="text" size="small">修改</el-button>
                                                            <el-button @click="delModelRelation(scope.$index,scope.row,'3')" type="text" size="small">删除</el-button>
                                                        </template>
                                                    </el-table-column>
                                                </el-table>
                                            </el-row>
                                        </el-collapse-item>
                                    </el-collapse>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="数据采集" name="addData">
                                <div style="margin-top: 15px;">
                                    <el-row>
                                        <el-col :span="5">&nbsp;</el-col>
                                        <el-col :span="18" style="text-align: left;">
                                            <el-button type="primary" @click="doSaveCoordData">保存</el-button>
                                        </el-col>
                                        <el-col :span="1">&nbsp;</el-col>
                                    </el-row>
                                </div>
                                <el-row style="margin-top: 15px;">
                                    <el-col :span="1">&nbsp;</el-col>
                                    <el-col :span="4">表名</el-col>
                                    <el-col :span="18">
                                        <el-input size="small" v-model="formTest.tableName" placeholder="请输入内容"></el-input>
                                    </el-col>
                                    <el-col :span="1">&nbsp;</el-col>
                                </el-row>
                                <el-row style="margin-top: 15px;">
                                    <el-col :span="1">&nbsp;</el-col>
                                    <el-col :span="4">经纬字段</el-col>
                                    <el-col :span="18">
                                        <el-input size="small" v-model="formTest.coordsCol" placeholder="请输入内容"></el-input>
                                    </el-col>
                                    <el-col :span="1">&nbsp;</el-col>
                                </el-row>
                                <el-row style="margin-top: 15px;">
                                    <el-col :span="1">&nbsp;</el-col>
                                    <el-col :span="4">轮播字段</el-col>
                                    <el-col :span="18">
                                        <el-input size="small" v-model="formTest.carouselCol" placeholder="请输入内容"></el-input>
                                    </el-col>
                                    <el-col :span="1">&nbsp;</el-col>
                                </el-row>
                                <el-row style="margin-top: 15px;">
                                    <el-col :span="1">&nbsp;</el-col>
                                    <el-col :span="4">轮播值</el-col>
                                    <el-col :span="18">
                                        <el-input size="small" v-model="formTest.carouselVal" placeholder="请输入内容"></el-input>
                                    </el-col>
                                    <el-col :span="1">&nbsp;</el-col>
                                </el-row>
                                <el-row style="margin-top: 15px;">
                                    <el-col :span="1">&nbsp;</el-col>
                                    <el-col :span="4">值字段</el-col>
                                    <el-col :span="18">
                                        <el-input size="small" v-model="formTest.valCol" placeholder="请输入内容"></el-input>
                                    </el-col>
                                    <el-col :span="1">&nbsp;</el-col>
                                </el-row>
                                <el-row style="margin-top: 15px;">
                                    <el-col :span="1">&nbsp;</el-col>
                                    <el-col :span="4">值范围</el-col>
                                    <el-col :span="8">
                                        <el-input size="small" v-model="formTest.valRange1" placeholder="请输入内容"></el-input>
                                    </el-col>
                                    <el-col :span="1">-</el-col>
                                    <el-col :span="8">
                                        <el-input size="small" v-model="formTest.valRange2" placeholder="请输入内容"></el-input>
                                    </el-col>
                                    <el-col :span="2">&nbsp;</el-col>
                                </el-row>
                                <div v-for="item in formTest.colVals">
                                    <el-row style="margin-top: 15px;">
                                        <el-col :span="1">&nbsp;</el-col>
                                        <el-col :span="4">经纬度值</el-col>
                                        <el-col :span="18">
                                            <el-input size="small" v-model="item.coordsVal" placeholder="请输入内容"></el-input>
                                        </el-col>
                                        <el-col :span="1">&nbsp;</el-col>
                                    </el-row>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                    </el-form>
                </el-main>
                <el-footer>
                    <el-form label-width="100px">
                        <el-button type="primary" @click="submitForm('form','create')">创建地图</el-button>
                        <el-button type="success" @click="submitForm('form','save')">保存地图</el-button>
                    </el-form>
                </el-footer>
            </el-container>

        </el-aside>
    </el-container>
    <el-dialog :title="dialogDataOperate+title" :visible.sync="dialogDatabing" width="45%">
        <el-dialog width="30%" title="样式设定" :visible.sync="innerVisible" append-to-body>
            <el-form ref="formMarks" :model="formMarks" lable-width="95">
                <el-form-item label="样式选择">
                    <el-radio-group v-model="formMarks.styleType">
                        <el-radio :label="0">默认</el-radio>
                        <el-radio :label="1">自定义</el-radio>
                    </el-radio-group>
                </el-form-item>
                <div v-if="formMarks.styleType=='1'">
                    <el-form-item label="显示方式" v-if="formMarks.dataType!='1' && formMarks.dataType!='2'">
                        <el-radio-group v-model="formMarks.iconStatus">
                            <el-radio :label="0">默认圆点</el-radio>
                            <el-radio :label="1">图标</el-radio>
                        </el-radio-group>
                    </el-form-item>
                    <div v-if="formMarks.iconStatus=='0'" style="text-align: left;">
                        <el-form-item label="原点大小">
                            <el-input-number v-model="formMarks.radius" :min="1" :max="100"></el-input-number>
                        </el-form-item>
                        <el-form-item label="原点颜色">
                            <el-color-picker v-model="formMarks.imageColor"></el-color-picker>
                        </el-form-item>
                        <el-form-item label="文字颜色">
                            <el-color-picker v-model="formMarks.textFillColor"></el-color-picker>
                        </el-form-item>
                        <el-form-item label="阴影颜色">
                            <el-color-picker v-model="formMarks.textStrokeColor"></el-color-picker>
                        </el-form-item>
                        <el-form-item label="阴影大小">
                            <el-input-number v-model="formMarks.textStrokeWidth" :min="1" :max="10"></el-input-number>
                        </el-form-item>
                    </div>
                    <div v-else style="text-align: left;">
                        <el-form-item label="图标清单" prop="iconData">
                            <el-select v-model="formMarks.iconData" placeholder="请选择图标" @change="iconChangeData">
                                <el-option v-for="(item,index) in iconList" :key="index" :label="item.iconNameCn" :value="index"></el-option>
                            </el-select>
                        </el-form-item>
                    </div>
                </div>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button @click="innerVisible = false">取 消</el-button>
                <el-button type="primary" @click="saveStyleData">保 存</el-button>
            </div>
        </el-dialog>
        <el-dialog width="30%" title="悬浮框设定" :visible.sync="innerFloatVisible" append-to-body>
            <el-table ref="multipleTable1" :data="floatData" @selection-change="handleFloatSelectionChange" tooltip-effect="dark" border style="width: 100%" size="mini" max-height="320">
                <el-table-column type="selection" width="35"></el-table-column>
                <el-table-column label="字段">
                    <template slot-scope="scope">{{ scope.row.COLUMN_RENAME }}</template>
                </el-table-column>
                <el-table-column label="数据别名">
                    <template slot-scope="scope">
                        <el-input size="mini" v-model="scope.row.dataLable"/>
                    </template>
                </el-table-column>
                <el-table-column label="聚合函数">
                    <template slot-scope="scope">
                        <el-select v-model="scope.row.groupBy" placeholder="请选择字段" size="mini">
                            <el-option v-for="item in groupBys" :key="item.key" :label="item.text" :value="item.key"></el-option>
                        </el-select>
                    </template>
                </el-table-column>
                <el-table-column label="排序">
                    <template slot-scope="scope">
                        <el-input size="mini" v-model="scope.row.orderNum"/>
                    </template>
                </el-table-column>
            </el-table>
            <div slot="footer" class="dialog-footer">
                <el-button @click="innerFloatVisible = false">取 消</el-button>
                <el-button type="primary" @click="doSaveModelDataFloat">保 存</el-button>
            </div>
        </el-dialog>
        <div v-if="dialogType=='1' || dialogType=='3'">
            <el-container>
                <el-aside width="350px">
                    <el-form ref="formMarks" :model="formMarks" :rules="dialogRules" label-width="95px">
                        <el-form-item :label="title+'名称'" prop="name">
                            <el-col :span="21"><el-input v-model="formMarks.name" autocomplete="off"></el-input></el-col>
                        </el-form-item>
                        <el-form-item label="区域名称" prop="addressCol">
                            <el-select v-model="formMarks.addressCol" placeholder="请选择字段" @change="changeRegion">
                                <el-option v-for="item in dimensionColList" :key="item.COLUMN_NAME" :label="item.COLUMN_RENAME" :value="item.COLUMN_NAME"></el-option>
                            </el-select>
                        </el-form-item>
                        <template v-if="formMarks.dataType=='3'">
                            <el-form-item label="区域状态" prop="displayNameStatus">
                                <el-switch v-model="formMarks.displayNameStatus" active-color="#13ce66" inactive-color="#ff4949" active-text="显示" inactive-text="不显示"></el-switch>
                            </el-form-item>
                        </template>
                        <el-form-item label="地理位置" prop="coordCol">
                            <el-select v-model="formMarks.coordCol" placeholder="请选择字段" @change="changeCoordCol">
                                <el-option v-for="item in dimensionColList" :key="item.COLUMN_NAME" :label="item.COLUMN_RENAME" :value="item.COLUMN_NAME"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="是否轮播" prop="carouselColType" v-if="formMarks.dataType=='1' || formMarks.dataType=='2'">
                            <el-radio-group v-model="formMarks.carouselColType">
                                <el-radio :label="0">否</el-radio>
                                <el-radio :label="1">是</el-radio>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item label="轮播绑定" prop="carouselCol" v-if="formMarks.dataType=='1' || formMarks.dataType=='2'">
                            <el-select v-model="formMarks.carouselCol" placeholder="请选择字段">
                                <el-option v-for="item in dimensionColList" :key="item.COLUMN_NAME" :label="item.COLUMN_RENAME" :value="item.COLUMN_NAME"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="值绑定" prop="valCol">
                            <el-select v-model="formMarks.valCol" placeholder="请选择字段">
                                <el-option v-for="item in metricColList" :key="item.COLUMN_NAME" :label="item.COLUMN_RENAME" :value="item.COLUMN_NAME"></el-option>
                            </el-select>
                        </el-form-item>
                        <template v-if="formMarks.dataType=='1'">
                            <el-form-item label="值状态" prop="displayNameStatus">
                                <el-switch v-model="formMarks.displayNameStatus" active-color="#13ce66" inactive-color="#ff4949" active-text="显示" inactive-text="不显示"></el-switch>
                            </el-form-item>
                        </template>
                        <el-form-item label="渲染方式" prop="hotType" v-if="formMarks.dataType=='2'">
                            <el-radio-group v-model="formMarks.hotType">
                                <el-radio :label="0">个数渲染</el-radio>
                                <el-radio :label="1">数值渲染</el-radio>
                            </el-radio-group>
                        </el-form-item>
                    </el-form>
                </el-aside>
                <el-container>
                    <el-header>数据绑定</el-header>
                    <el-main>
                        <div class="show_table_button">
                            <el-button @click="openSetStyleDialg('much')" size="mini">批量设置样式</el-button>
                            <template v-if="formMarks.dataType=='3'">
                                <el-button @click="openSetFloatDialog" size="mini">悬浮框设置</el-button>
                            </template>
                        </div>
                        <el-table ref="multipleTable" :data="tableDatas" @selection-change="handleSelectionChange" tooltip-effect="dark" border style="width: 100%" size="mini" max-height="320">
                            <el-table-column type="selection" width="35"></el-table-column>
                            <el-table-column label="名称">
                                <template slot-scope="scope">{{ scope.row.REGION }}</template>
                            </el-table-column>
                            <el-table-column label="操作">
                                <template slot-scope="scope">
                                    <el-button size="mini" @click="openSetStyleDialg('single',scope.row)">样式设定</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-main>
                </el-container>
            </el-container>
        </div>
        <div v-else>
            <el-form ref="formMarks" :model="formMarks" :rules="dialogRules" label-width="95px">
                <el-form-item :label="title+'名称'" prop="name">
                    <el-col :span="12"><el-input v-model="formMarks.name" autocomplete="off"></el-input></el-col>
                    <el-col :span="2">&nbsp;</el-col>
                    <el-col :span="10"><el-switch v-model="formMarks.displayNameStatus" active-color="#13ce66" inactive-color="#ff4949" active-text="显示" inactive-text="不显示"></el-switch></el-col>
                </el-form-item>
                <el-form-item label="地址绑定" prop="addressCol">
                    <el-select v-model="formMarks.addressCol" placeholder="请选择字段">
                        <el-option v-for="item in dimensionColList" :key="item.COLUMN_NAME" :label="item.COLUMN_RENAME" :value="item.COLUMN_NAME"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="地理位置" prop="coordCol">
                    <el-select v-model="formMarks.coordCol" placeholder="请选择字段">
                        <el-option v-for="item in dimensionColList" :key="item.COLUMN_NAME" :label="item.COLUMN_RENAME" :value="item.COLUMN_NAME"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="是否轮播" prop="carouselColType" v-if="formMarks.dataType=='1' || formMarks.dataType=='2'">
                    <el-radio-group v-model="formMarks.carouselColType">
                        <el-radio :label="0">否</el-radio>
                        <el-radio :label="1">是</el-radio>
                    </el-radio-group>
                </el-form-item>
                <el-form-item label="轮播绑定" prop="carouselCol" v-if="formMarks.dataType=='1' || formMarks.dataType=='2'">
                    <el-select v-model="formMarks.carouselCol" placeholder="请选择字段">
                        <el-option v-for="item in dimensionColList" :key="item.COLUMN_NAME" :label="item.COLUMN_RENAME" :value="item.COLUMN_NAME"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="值绑定" prop="valCol">
                    <el-select v-model="formMarks.valCol" placeholder="请选择字段">
                        <el-option v-for="item in metricColList" :key="item.COLUMN_NAME" :label="item.COLUMN_RENAME" :value="item.COLUMN_NAME"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="渲染方式" prop="hotType" v-if="formMarks.dataType=='2'">
                    <el-radio-group v-model="formMarks.hotType">
                        <el-radio :label="0">个数渲染</el-radio>
                        <el-radio :label="1">数值渲染</el-radio>
                    </el-radio-group>
                </el-form-item>
                <el-form-item label="样式选择">
                    <el-radio-group v-model="formMarks.styleType">
                        <el-radio :label="0">默认</el-radio>
                        <el-radio :label="1">自定义</el-radio>
                    </el-radio-group>
                </el-form-item>
                <div v-if="formMarks.styleType=='1'">
                    <el-form-item label="显示方式" v-if="formMarks.dataType!='1' && formMarks.dataType!='2'">
                        <el-radio-group v-model="formMarks.iconStatus">
                            <el-radio :label="0">默认圆点</el-radio>
                            <el-radio :label="1">图标</el-radio>
                        </el-radio-group>
                    </el-form-item>
                    <div v-if="formMarks.iconStatus=='0'" style="text-align: left;">
                        <el-form-item label="原点大小">
                            <el-input-number v-model="formMarks.radius" :min="1" :max="100"></el-input-number>
                        </el-form-item>
                        <el-form-item label="原点颜色">
                            <el-color-picker v-model="formMarks.imageColor"></el-color-picker>
                        </el-form-item>
                        <el-form-item label="文字颜色">
                            <el-color-picker v-model="formMarks.textFillColor"></el-color-picker>
                        </el-form-item>
                        <el-form-item label="阴影颜色">
                            <el-color-picker v-model="formMarks.textStrokeColor"></el-color-picker>
                        </el-form-item>
                        <el-form-item label="阴影大小">
                            <el-input-number v-model="formMarks.textStrokeWidth" :min="1" :max="10"></el-input-number>
                        </el-form-item>
                    </div>
                    <div v-else style="text-align: left;">
                        <el-form-item label="图标清单" prop="iconData">
                            <el-select v-model="formMarks.iconData" placeholder="请选择图标" @change="iconChangeData">
                                <el-option v-for="(item,index) in iconList" :key="index" :label="item.iconNameCn" :value="index"></el-option>
                            </el-select>
                        </el-form-item>
                    </div>
                </div>
            </el-form>
        </div>

        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogDatabing = false">取 消</el-button>
            <el-button type="primary" @click="submitDialogForm('formMarks')">确 定</el-button>
        </div>
    </el-dialog>
</div>
<script type="text/javascript">
    var mapVue= new Vue({
        el: '#app',
        data:{
            dialogDataOperate:'',
            dialogDatabing:false,
            activeDataModel:[],
            modelRadio:'',
            modelRadioEnName:'',
            modelData:[],
            dimensionColList:[],
            metricColList:[],
            iconList:[],
            formLabelWidth: '120px',
            pkey:'',
            activeName:'systemBase',
            activeDatas:['1'],
            dialogType:'1',

            modelDataChoice:false,
            choiceModelName:'请选择数据模型',
            models:[],
            choiceModelData:'',
            currentPage: 1,
            pageSize: 5,
            totalCount: 0,
            prevText: '上一页',
            nextText: '下一页',

            marksHeadData:[],
            hotMapData:[],
            lableMapData:[],
            carouselMapData:[],
            title:'标注',
            dialogFormVisible:false,
            formMarks:{
                name:'',
                displayNameStatus:true,
                addressCol:'',
                coordCol:'',
                carouselColType:0,
                carouselCol:'',
                valCol:'',
                styleType:0,
                status:'1',
                iconStatus:0,
                opacity:0.7,
                iconData:'',
                iconName:'',
                iconType:'',
                radius:4,
                imageColor:'#3392F4',
                textAlign:'center',
                textBaseline:'middle',
                font:'normal 14px 微软雅黑',
                text:'',
                textFillColor:'#FDF9FE',
                textStrokeColor:'#ffcc33',
                textStrokeWidth:2,
                opt:'add',
                MODEL_RELATION_ID:'',
                dataType:'1',
                hotType:0,
            },
            dialogRules:{
                name: [
                    { required: true, message: '请输入名称', trigger: 'blur' },
                    { min: 3, max: 15, message: '长度在 3 到 15 个字符', trigger: 'blur' }
                ],
                addressCol:[
                    { required: true, message: '请选择地址', trigger: 'change' }
                ],
                coordCol:[
                    { required: true, message: '请选择地理位置', trigger: 'change' }
                ],
                carouselCol:[
                    { required: true, message: '请绑定轮播字段', trigger: 'change' }
                ],
                valCol:[
                    { required: true, message: '请选择值', trigger: 'change' }
                ],
                iconName:[
                    { required: true, message: '请选择图标', trigger: 'change' }
                ]
            },
            modifyIndex:-1,
            form:{
                name:'',
                target:'map',
                levels:'district',
                province:'',
                city:'',
                district:'',
                lng:'',
                lat:'',
                zoom:'',
                projection:'EPSG:4326',
                otherMap:0,
                mapType:'amap',
                fillColor:'rgba(0, 0, 0, 0)',
                strokeColor:'#080107',
                areaColor:'rgba(88, 131, 226, 0.2)',
                areaStrokeColor:'rgba(88, 131, 226, 1)',
                areaStrokeWidth:2,
                events:[]
            },
            rules:{
                name: [
                    { required: true, message: '请输入地图名称', trigger: 'blur' },
                    { min: 3, max: 15, message: '长度在 3 到 15 个字符', trigger: 'blur' }
                ],
                target:[
                    { required: true, message: '渲染元素不能为空', trigger: 'change' }
                ],
                levels:[
                    { required: true, message: '显示级别不能为空', trigger: 'change' }
                ],
                province:[
                    { required: true, message: '省级不能为空', trigger: 'change' }
                ],
                city:[
                    { required: true, message: '市级不能为空', trigger: 'change' }
                ],
                district:[
                    { required: true, message: '区级不能为空', trigger: 'change' }
                ],
                lng:[
                    { required: true, message: '经度不能为空', trigger: 'change' }
                ],
                lat:[
                    { required: true, message: '纬度不能为空', trigger: 'change' }
                ],
                zoom:[
                    { required: true, message: '缩放级别不能为空', trigger: 'change' }
                ]
            },
            zooms:[
                {value:1,label:'1级'},
                {value:2,label:'2级'},
                {value:3,label:'3级'},
                {value:4,label:'4级'},
                {value:5,label:'5级'},
                {value:6,label:'6级'},
                {value:7,label:'7级'},
                {value:8,label:'8级'},
                {value:9,label:'9级'},
                {value:10,label:'10级'},
                {value:11,label:'11级'},
                {value:12,label:'12级'},
                {value:12.5,label:'12.5级'},
                {value:13,label:'13级'},
                {value:14,label:'14级'},
                {value:15,label:'15级'},
                {value:16,label:'16级'},
                {value:17,label:'17级'},
                {value:18,label:'18级'},
                {value:19,label:'19级'},
                {value:20,label:'20级'}
            ],
            mapCfgs:{
                baseInfo:{},
                styleInfo:{}
            },
            showMap:false,
            areaCodes:[],
            provinces:[],
            provinceOption:[],
            citys:[],
            cityOption:[],
            districts:[],
            districtOption:[],
            timer:'',
            loopHeatMap:'',
            formTest:{
                tableName:'',
                coordsCol:'',
                carouselCol:'',
                carouselVal:'',
                valCol:'',
                valRange1:'',
                valRange2:'',
                colVals:[]
            },


            tableDatas:[],
            innerVisible:false,
            innerFloatVisible:false,
            floatData :[{
                colName:'address',
                dataLable:'地址',
                groupBy:'0',
                orderNum:1
            },{
                colName:'address1',
                dataLable:'地址2',
                groupBy:'0',
                orderNum:2
            }],
            cols:[],
            groupBys:[{
                key:'0',
                text:'无'
            },{
                key:'1',
                text:'求和'
            }],
            colDatas:[],
            styleDatas:'',
            saveFloatData:[],
            floatDialog:false,
            floatDialogTop:0,
            floatDialogLeft:0,
            floatDialogData:[{
                val:'12',
                name:'门诊人次'
            },{
                val:'古美',
                name:'机构名称'
            }],
            allFloatDialogData:'',
        },
        created(){
            this.loadParam();
        },
        methods:{
            targetChange:function(val){
                $('#'+val).html('');
            },
            submitForm:function(formName,type) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        this.getMapCfgs();
                        let cfgs = this.mapCfgs.baseInfo;
                        for(let p in this.mapCfgs.styleInfo){
                            cfgs[p] = this.mapCfgs.styleInfo[p];
                        }
                        if(type=='create'){
                            initMap(cfgs);
                            debugger;
                            this.loadDataByEvents(cfgs.events);
                            this.showMap = true;
                        }else if(type='save'){
                            if(!this.showMap){
                                initMap(cfgs);
                                this.loadDataByEvents(cfgs.events);
                            }
                            let params = this.mapCfgs;
                            params['name'] = this.form.name;
                            if(this.pkey!=''){
                                params['id'] = this.pkey;
                            }
                            this.saveGisData('POST',configpre.map_saveMapData,params);
                        }
                    } else {
                        if(this.activeName=='systemStyle' || this.activeName=='bindData'){
                            this.myMessage('请完善【基础设置】数据','error');
                        }
                        return false;
                    }
                });
            },
            loadDataByEvents:function(events){
                if(events.length>0){
                    events.forEach(item=>{
                        switch (item){
                            case 'singleclick':break;
                            case 'pointermove':this.loadFloatDialogByEvent();break;
                            case 'moveend':break;
                        }
                    });
                }
            },
            loadFloatDialogByEvent:function(){
                //加载悬浮框数据
            },
            resetForm:function(formName) {
                this.$refs[formName].resetFields();
                this.form.otherMap=0;
                this.form.events=[];
                this.resetMapCfgs();
            },
            getMapCfgs:function(){
                this.resetMapCfgs();
                let form = this.form;
                this.mapCfgs.baseInfo['name']=form.name;
                this.mapCfgs.baseInfo['target']=form.target;
                this.mapCfgs.baseInfo['center']=[form.lng,form.lat];
                this.mapCfgs.baseInfo['zoom']=form.zoom;
                this.mapCfgs.baseInfo['projection']=form.projection;
                this.mapCfgs.baseInfo['levels']=form.levels;
                if(form.levels=='province'){
                    this.mapCfgs.baseInfo['upAreaCode']='100000';
                    this.mapCfgs.baseInfo['areaCode']=form.province;
                }else if(form.levels=='city'){
                    this.mapCfgs.baseInfo['upAreaCode']=form.province;
                    this.mapCfgs.baseInfo['areaCode']=form.city;
                }else if(form.levels=='district'){
                    this.mapCfgs.baseInfo['upAreaCode']=form.city;
                    this.mapCfgs.baseInfo['areaCode']=form.district;
                }else if(form.levels=='street'){
                    this.mapCfgs.baseInfo['upAreaCode']=form.city+'-1';
                    this.mapCfgs.baseInfo['areaCode']=form.district+'-1';
                }
                if(form.otherMap=='1'){
                    this.mapCfgs.baseInfo['otherMap']=form.otherMap;
                    this.mapCfgs.baseInfo['mapType']=form.mapType;
                }
                this.mapCfgs.baseInfo['events']=form.events;
                this.mapCfgs.styleInfo['fillColor']=form.fillColor;
                this.mapCfgs.styleInfo['areaColor']=form.areaColor;
                this.mapCfgs.styleInfo['areaStrokeColor']=form.areaStrokeColor;
                this.mapCfgs.styleInfo['areaStrokeWidth']=form.areaStrokeWidth;
            },
            resetMapCfgs:function(){
                $('#'+this.form.target).html('');
                this.mapCfgs.baseInfo={};
                this.mapCfgs.styleInfo={};
            },
            rquestParams:function(method,api,data){
                let jsonDataList={
                    httpMethod:method,
                    url:api,
                    data:data?JSON.stringify(data):''
                };
                return jsonDataList;
            },
            saveGisData:function(method,api,data){
                let me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200'){
                        me.pkey = json.body;
                        me.myMessage('恭喜您，保存成功!','success');
                        me.createHtmlTemplet();
                    }else{
                        me.myMessage('保存失败，请稍后再试!','error');
                    }
                });
            },
            /**
             * msg：提示信息
             * type：消息类型：success：成功；error：错误；warning：警告；
             * */
            myMessage:function(msg,type) {
                this.$message({
                    message: msg,
                    type: type
                });
            },
            createHtmlTemplet:function(){
                let html='<!DOCTYPE html>'
                            +'<html lang="en">'
                            +'<head>'
                            +'    <meta charset="UTF-8">'
                            +'    <title>Title</title>'
                            +'    <link rel="stylesheet" href="../css/ol.css" type="text/css">'
                            +'    <script type="text/javascript" src="../js/ajaxrequestasync.js"></s'+ 'cript>'
                            +'    <script type="text/javascript" src="../js/ajaxrequestsync.js"></s'+ 'cript>'
                            +'    <script type="text/javascript" src="../js/config.js"></s'+ 'cript>'
                            +'    <script src="../js/jquery-2.2.3.min.js"></s'+ 'cript>'
                            +'    <script src="../js/bootstrap.js"></s'+ 'cript>'
                            +'    <script src="../js/ol.js"></s'+ 'cript>'
                            +'    <script src="../js/map.js"></s'+ 'cript>'
                            +'    <link rel="stylesheet" href="../css/element.css">'
                            +'    <script type="text/javascript" src="../js/vue.min.js"></s'+ 'cript>'
                            +'    <script src="../js/element.js"></s'+ 'cript>'
                            +'    <link rel="stylesheet" href="../css/showMap.css">'
                            +'</head>'
                            +'<body>'
                            +'<div id="app" class="fullScreen">'
                            +'    <div id="title" class="title_center">{{title}}</div>'
                            +'    <div id="map" class="fullScreen" ref="mymap"></div>'
                            +'    <div class="show_right" title="显示设置" @click="drawer = true"><i class="el-icon-info"></i></div>'
                            +'    <el-drawer title="显示设置明细" :visible.sync="drawer" :before-close="handleClose" :size="size">'
                            +'        <el-table ref="multipleTable" :data="tableData" @selection-change="handleSelectionChange" tooltip-effect="dark" border style="width: 100%" size="mini" max-height="350">'
                            +'            <el-table-column type="selection" width="55"></el-table-column>'
                            +'            <el-table-column label="名称" width="220">'
                            +'                <template slot-scope="scope">{{ scope.row.MODEL_RELATION_NAME }}</template>'
                            +'            </el-table-column>'
                            +'            <el-table-column prop="MODEL_RELATION_TYPE" label="类别">'
                            +'                <template slot-scope="scope">'
                            +'                    <el-tag :type="scope.row.MODEL_RELATION_TYPE === \'1\' ? \'primary\' : \'success\'" disable-transitions>{{scope.row.MODEL_RELATION_TYPE === \'1\'?\'标注\':\'热力图\'}}</el-tag>'
                            +'                </template>'
                            +'            </el-table-column>'
                            +'        </el-table>'
                            +'        <div style="margin: 20px 0px 0px 20px;">'
                            +'            <el-button type="primary" @click="showMap()">确定</el-button>'
                            +'            <el-button type="success" @click="toggleSelection()">重置</el-button>'
                            +'        </div>'
                            +'    </el-drawer>'
                            +'    <div class="bottom_right">'
                            +'        <div v-for="item in showBottomRight">'
                            +'            <el-row v-if="item.isImg" style="margin-top: 5px;">'
                            +'                <el-col :span="1">&nbsp;</el-col>'
                            +'                <el-col :span="3" style="min-width: 40px;"><img :src="item.imgUrl"/></el-col>'
                            +'                <el-col :span="18"><div class="div_middle">{{item.showName}}</div></el-col>'
                            +'            </el-row>'
                            +'            <el-row v-else style="margin-top: 5px;">'
                            +'                <el-col :span="1">&nbsp;</el-col>'
                            +'                <el-col :span="3" style="min-width: 40px;"><div class="div_circle" :style="{backgroundColor:item.imageColor}"></div></el-col>'
                            +'                <el-col :span="18"><div class="div_middle">{{item.showName}}</div></el-col>'
                            +'            </el-row>'
                            +'         </div>'
                            +'        <div v-else></div>'
                            +'    </div>'
                            +'</div>'
                            +'<script type="text/javascript">'
                            +'    new Vue({el: \'#app\','
                            +'        data:{ size:\'20%\',drawer: false,tableData:[],marks:[],styleInfo:\'\',multipleSelection:[],title:\'\', showBottomRight:[]},'
                            +'        mounted(){this.loadGisData(\'POST\',configpre.map_getMapByPkey,{ID:"'+this.pkey+'"});this.loadModelRelationData(\'POST\',configpre.map_loadModelRelation); this.getHeight();},'
                            +'        methods:{'
                            +'            getHeight:function(){let width = this.$refs.mymap.offsetWidth;let percent = 384/width;if(percent>0.2){this.size=parseInt(percent*100)+\'%\';}},'
                            +'            handleClose:function(done) {done();},'
                            +'            rquestParams:function(method,api,data){var jsonDataList={httpMethod:method,url:api,data:data?JSON.stringify(data):\'\'};return jsonDataList;},'
                            +'            loadGisData:function(method,api,data){var me = this;var jsonDataList = this.rquestParams(method,api,data);ajaxrequestasync(jsonDataList,function(code,msg,json){if(code==\'200\'){var body = json.body;var baseInfo = JSON.parse(body.BASE_INFO);var styleInfo = JSON.parse(body.STYLE_INFO);me.styleInfo = styleInfo;me.title = body.MAP_NAME;var cfgs = baseInfo;for(var p in styleInfo){cfgs[p] = styleInfo[p];}initMap(cfgs);}});},'
                            +'            loadModelRelationData:function(method,api,data){var me = this;var jsonDataList = this.rquestParams(method,api,data);ajaxrequestasync(jsonDataList,function(code,msg,json){if(code==\'200\' && json.body){me.tableData = [];let marksHeadData = json.body.markList||[];let hotMapData = json.body.hotMapList||[];me.tableData = me.tableData.concat(marksHeadData).concat(hotMapData);}});},'
                            +'            toggleSelection:function(){cleanMarks();this.$refs.multipleTable.clearSelection();},'
                            +'            handleSelectionChange:function(val){this.multipleSelection = val;},'
                            +'            showMap:function(){if(this.multipleSelection.length==0){this.myMessage(\'请选择数据\',\'warning\');return;}this.showBottomRight = [];this.multipleSelection.forEach(item=>{let cfgs = {};cfgs[\'showName\'] = item.MODEL_RELATION_NAME;let style = JSON.parse(item.MODEL_STYLE_DATA);let iconStatus = style.iconStatus==\'1\'?true:false;cfgs[\'isImg\'] = iconStatus;if(iconStatus){cfgs[\'imgUrl\'] = configpre.webGisPath+\'static/icon/\'+style.iconName+\'.\'+style.iconType;}else{cfgs[\'imageColor\'] = style.imageColor;}this.showBottomRight.push(cfgs);});let params = {modelRelation:this.multipleSelection};this.loadTableData(\'POST\',configpre.map_queryTableDataByGisModelRelation,params);},'
                            +'            myMessage:function(msg,type) {this.$message({message: msg,type: type});},'
                            +'            loadTableData:function(method,api,data){let me = this;let jsonDataList = this.rquestParams(method,api,data);ajaxrequestasync(jsonDataList,function(code,msg,json){if(code==\'200\' && json.body){let body = json.body;cleanMarks();body.forEach(item=>{let cfgs = item.style;if(typeof(cfgs)==\'string\'){cfgs = JSON.parse(item.style);}let datas = item.data;datas.forEach(data=>{let coords = eval(data.COORDS);cfgs[\'lng\']=coords[0]; cfgs[\'lat\']=coords[1];addMarksV2(cfgs);});});me.drawer =false;} });}'
                            +'		}'
                            +'    });'
                            +'</s'+ 'cript>'
                            +'</body>'
                            +'</html>';
                html=html.replace(/%/g,'%25');//将百分号转义
                html=html.replace(/\+/g,'%2b');//将百分号转义
                let fileName='GIS_'+this.pkey;
                let fileType="html";
                let fileInfor={
                    fileName:fileName,
                    fileType:fileType,
                    data:html,
                }
                let fileJsonData=this.rquestParams('POST',configpre.map_createFile,fileInfor);
                let me = this;
                ajaxrequestasync(fileJsonData,function(code,msg,json){
                    if(code=='200'){
                        let templateUrl=json.body;
                        me.$alert('保存成功，模板路径：'+templateUrl, '提示', {
                            confirmButtonText: '确定',
                        });
                    }else{
                        me.$message({
                            showClose: true,
                            type: 'error',
                            message: '模板文件生成失败！',
                            duration:1500
                        });
                    }
                })
            },
            loadParam:function(){
                //加载行政区划数据
                this.loadAreaCode('POST',configpre.map_loadAreaCodeData);
                //加载标注数据
                //this.loadModelRelationData('POST',configpre.map_loadModelRelation);
                //
                //this.loadModelData('POST',configpre.api_loadModelDataWithLayout);
                this.loadModel('POST',configpre.api_loadModels,{pageSize: this.pageSize, pageNo: 1});
            },
            initDialogParam:function(init){
                if(init){
                    this.modelRadio='';
                    this.modelRadioEnName = '';
                    this.tableDatas=[];
                }
                this.modifyIndex=-1;
                this.dimensionColList=[];
                this.metricColList=[];
                this.formMarks.name='';
                this.formMarks.displayNameStatus=true;
                this.formMarks.addressCol='';
                this.formMarks.coordCol='';
                this.formMarks.carouselCol='';
                this.formMarks.carouselColType=0;
                this.formMarks.hotType=0;
                this.formMarks.valCol='';
                this.formMarks.styleType=0;
                this.formMarks.status='1';
                this.formMarks.iconStatus=0;
                this.formMarks.opacity=0.7;
                this.formMarks.iconData='';
                this.formMarks.iconName='disease';
                this.formMarks.iconType='jpg';
                this.formMarks.radius=4;
                this.formMarks.imageColor='#3392F4';
                this.formMarks.textAlign='center';
                this.formMarks.textBaseline='middle';
                this.formMarks.font='normal 14px 微软雅黑';
                this.formMarks.text='';
                this.formMarks.textFillColor='#FDF9FE';
                this.formMarks.textStrokeColor='#ffcc33';
                this.formMarks.textStrokeWidth=2;
                this.formMarks.opt='add';
            },
            loadAreaCode:function(method,api,data){
                let me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200' && json.body){
                        me.provinces = json.body.provinces;
                        me.provinceOption = json.body.provinces;
                        me.citys = json.body.citys;
                        me.districts = json.body.districts;
                    }
                });
            },
            loadModelRelationData:function(method,api,data){
                let me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200' && json.body){
                       me.marksHeadData = json.body.markList||[];
                       me.hotMapData = json.body.hotMapList||[];
                       me.lableMapData=json.body.lableList||[];
                       me.carouselMapData = json.body.carouselList||[];
                    }
                });
            },
            loadModelData:function(method,api,data){
                let me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200' && json.body){
                        me.modelData = json.body;
                        for(let i=0,length=me.modelData.length;i<length;i++){
                            me.activeDataModel.push(i);
                        }
                    }
                });
            },
            saveMarksData:function(data,index){
                let me = this;
                let type = this.formMarks.opt;
                let dataType = data.MODEL_RELATION_TYPE;
                let jsonDataList = this.rquestParams('POST',configpre.map_saveModelRelation,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200'){
                        let msg = '修改成功';
                        if(type=='delete'){
                            msg="删除成功";
                            if(dataType=='1'){
                                me.marksHeadData.splice(index,1);
                            }else if(dataType=='2'){
                                me.hotMapData.splice(index,1);
                            }else if(dataType=='3'){
                                me.lableMapData.splice(index,1);
                            }else if(dataType=='4'){
                                me.carouselMapData.splice(index,1);
                            }
                        }else if(type=='add'){
                            msg="添加成功";
                            data.MODEL_RELATION_ID=json.body;
                            if(dataType=='1'){
                                me.marksHeadData.push(data);
                            }else if(dataType=='2'){
                                me.hotMapData.push(data);
                            }else if(dataType=='3'){
                                me.lableMapData.push(data);
                            }else if(dataType=='4'){
                                me.carouselMapData.push(data);
                            }
                        }else if(type=='modify'){
                            msg = '修改成功';
                            if(dataType=='1'){
                                me.marksHeadData.splice(index,1,data);
                            }else if(dataType=='2'){
                                me.hotMapData.splice(index,1,data);
                            }else if(dataType=='3'){
                                me.lableMapData.splice(index,1,data);
                            }else if(dataType=='4'){
                                me.carouselMapData.splice(index,1,data);
                            }
                        }
                        me.myMessage(msg,'success');
                    }else{
                        me.myMessage('操作失败','error');
                    }
                });
            },
            areaCodeChange:function(type){
                if(type=='province'){
                    this.form.city = '';
                    this.form.district = '';
                    this.cityOption=[];
                    this.districtOption=[];
                    this.citys.forEach(city=>{
                        if(city.AREA_CODE_PARENT==this.form.province){
                            this.cityOption.push(city);
                        }
                    });
                }else if(type=='city'){
                    this.form.district = '';
                    this.districtOption=[];
                    this.districts.forEach(district=>{
                        if(district.AREA_CODE_PARENT==this.form.city){
                            this.districtOption.push(district);
                        }
                    });
                }
                if(this.form.levels==type || (this.form.levels=='street' && type=='district')){
                    this.setMapCenter(type);
                }
            },
            areaCodeLevelsChange:function(val){
                this.form.lng = '';
                this.form.lat = '';
                this.setMapCenter(val);
            },
            setMapCenter:function(type){
                let data=[];
                let areaCode;
                if(type=='province'){
                    data = this.provinceOption;
                    areaCode = this.form.province;
                }else if(type=='city'){
                    data = this.cityOption;
                    areaCode = this.form.city;
                }else if(type=='district' || type=='street'){
                    data = this.districtOption;
                    areaCode = this.form.district;
                }
                data.forEach(item=>{
                    if(item.AREA_CODE==areaCode){
                        this.form.lng = item.LNG;
                        this.form.lat = item.LAT;
                    }
                });
            },
            /**
             * 数组转标题名称
             * @param dataType
             * @returns 标题名称
             */
            numToTitle:function(dataType){
                let title;
                switch (dataType){
                    case '1':title='散点图';break;
                    case '2':title='热力图';break;
                    case '3':title='标注';break;
                    case '4':title='轮播图';break;
                    default:title='散点图';break;
                }
                return title;
            },
            /**
             * 数组转操作类型名称
             * @param optType
             * @returns 类型名称
             */
            numToTypeName:function(optType){
                let typeName;
                switch (optType){
                    case 'add':typeName='新增';break;
                    case 'modify':typeName='修改';break;
                    case 'delete':typeName='删除';break;
                    case 'view':typeName='查看';break;
                    default:typeName='新增';break;
                }
                return typeName;
            },
            /**
             * 打开弹框页面
             * @param dataType 类型:1:散点图，2：热力图，3：标注，4：轮播图
             * @param optType 操作类型：add新增，modify修改，delete 删除，view:查看
             * @param row
             */
            openWin:function(dataType,optType,row){
                this.dialogType = dataType;
//                if(!this.showMap){
//                    this.myMessage('请先创建地图','warning');
//                    return;
//                }
                this.dialogDatabing = true;
                this.dialogDataOperate = this.numToTypeName(optType);
                this.title = this.numToTitle(dataType);
                this.formMarks.dataType=dataType;
                this.formMarks.status='1';
                this.formMarks.opt=optType;
                if(optType=='add'){
                    if(dataType=='2'){

                    }
                    this.initDialogParam(true);
                    this.modelChange(this.choiceModelData.ID,this.choiceModelData.EN_NAME);
                }else if(optType=='modify'){
                    this.changeRegion(row.RELATION_DIM_ADDRESS);
                    let params = {
                        MODEL_ID: row.MODEL_ID,
                        TABLE_NAME: row.TABLE_NAME
                    };
                    this.loadModelColumnData('POST',configpre.api_loadColsByTableNameAndModleId,params,row.RELATION_DIM_COOR);
//                    this.modelRadio = row.MODEL_ID;
                    this.formMarks.name=row.MODEL_RELATION_NAME;
                    this.formMarks.addressCol=row.RELATION_DIM_ADDRESS;
                    this.formMarks.coordCol=row.RELATION_DIM_COOR;
                    this.formMarks.carouselCol=row.RELATION_DIM_CAROUSEL;
                    this.formMarks.valCol=row.RELATION_MEASURE_VAL;
                    this.formMarks.MODEL_RELATION_ID=row.MODEL_RELATION_ID;
                    let styleData = row.MODEL_STYLE_DATA;
                    if(typeof(row.MODEL_STYLE_DATA) == "string"){
                        styleData = JSON.parse(row.MODEL_STYLE_DATA);
                    }
                    for(let p in styleData){
                        this.formMarks[p] = styleData[p];
                    }
                }
            },

            saveDialogData:function(index){
                let data ={};
                let formMarks = this.formMarks;
                let marksStyleData = {};
                marksStyleData['iconStatus'] = formMarks.iconStatus;
                marksStyleData['opacity'] = formMarks.opacity;
                marksStyleData['iconName'] = formMarks.iconName;
                marksStyleData['iconType'] = formMarks.iconType;
                marksStyleData['radius'] = formMarks.radius;
                marksStyleData['imageColor'] = formMarks.imageColor;
                marksStyleData['textAlign'] = formMarks.textAlign;
                marksStyleData['textBaseline'] = formMarks.textBaseline;
                marksStyleData['font'] = formMarks.font;
                marksStyleData['text'] = formMarks.name;
                marksStyleData['textFillColor'] = formMarks.textFillColor;
                marksStyleData['textStrokeColor'] = formMarks.textStrokeColor;
                marksStyleData['textStrokeWidth'] = formMarks.textStrokeWidth;
                marksStyleData['styleType'] = formMarks.styleType;
                marksStyleData['displayNameStatus'] = formMarks.displayNameStatus;
                marksStyleData['carouselColType']=formMarks.carouselColType;
                marksStyleData['hotType']=formMarks.hotType;
                data['MODEL_RELATION_NAME']=formMarks.name;
                data['MODEL_RELATION_TYPE']=formMarks.dataType;
                if(formMarks.opt=='modify'){
                    data['MODEL_RELATION_ID'] = formMarks.MODEL_RELATION_ID;
                }
                data['STATUS'] = formMarks.status;
                data['MODEL_ID']=this.choiceModelData.ID;
                data['TABLE_NAME']=this.choiceModelData.EN_NAME;
                data['RELATION_DIM_COOR']=formMarks.coordCol;
                data['RELATION_DIM_CAROUSEL']=formMarks.carouselCol;
                data['RELATION_DIM_ADDRESS']=formMarks.addressCol;
                data['RELATION_MEASURE_VAL']=formMarks.valCol;
                data['MODEL_STYLE_DATA']=marksStyleData;
                this.saveMarksData(data,index);
            },
            modifyClick:function(index, row,type){
                this.modifyIndex=index;
                this.modelRadioEnName = row.TABLE_NAME;
                this.modelRadio = row.MODEL_ID;
                this.openWin(type,'modify',row);
            },
            showMarks:function(index,row,type){
//                if(!this.showMap){
//                    this.myMessage('请先创建地图','warning');
//                    return;
//                }
                debugger;
                let params = {modelRelation:[row]};

                let modelStyleData = row.MODEL_STYLE_DATA;
                if(typeof(row.MODEL_STYLE_DATA) == "string"){
                    modelStyleData = JSON.parse(row.MODEL_STYLE_DATA);
                }
                if(modelStyleData.carouselColType && modelStyleData.carouselColType=='1'){
                    params['isCarousel'] = true;
                }
                let apiPath = configpre.map_queryTableDataByGisModelRelationV2;
                if(type=='2'){
                    apiPath = configpre.map_queryHeatMapDataByGisModelRelation;
                }
                this.loadTableData('POST',apiPath,params,type);
                this.loadDialogDataByRelation(row);
            },
            loadDialogDataByRelation:function(row){
                let data = {
                    DATA_MODEL_ID:row.MODEL_ID,
                    TABLE_NAME:row.TABLE_NAME,
                    COORDS:row.RELATION_DIM_COOR
                }
                const me = this;
                let jsonDataList = this.rquestParams('POST',configpre.map_loadFloatDialogByRelation,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200'){
                        me.allFloatDialogData = json.body ||'';
                    }
                });
            },
            delModelRelation:function(index,row){
                row['STATUS'] ='0';
                this.formMarks.opt='delete';
                this.saveMarksData(row,index);
            },
            modelChange:function(modelId,tableName){
                this.initDialogParam();
                this.modelRadioEnName = tableName;
                this.modelRadio = modelId;
                let params = {
                    MODEL_ID: modelId,
                    TABLE_NAME: tableName
                };
                this.loadModelColumnData('POST',configpre.api_loadColsByTableNameAndModleId,params);
            },
            loadModelColumnData:function(method,api,data,floatCol){
                let me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200' && json.body){
                        let body = json.body;
                        me.dimensionColList = body.dimensionColList ||[];
                        me.metricColList = body.metricColList ||[];
                        if(floatCol){
                            me.changeCoordCol(floatCol);
                        }
                    }
                });
            },
            loadTableData:function(method,api,data,type){
                let me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200' && json.body){
                        let body = json.body;
                        me.showData(body,type);
                    }
                });
            },
            /**
             * 显示地图数据
             * @param body
             * @param type
             */
            showData:function(body,type){
                switch(type){
                    case '1':
                        this.carourselData(body);
                        break;
                    case '2':
                        this.carourselHeatMap(body)
                        break;
                    case '3':
                        this.cleanMapData();
                        body.forEach(item=>{
                            let cfgs={};
                            let datas = item.data;
                            datas.forEach(data=>{
                                cfgs = data.style;
                                if(typeof(cfgs)=='string'){
                                    cfgs = JSON.parse(data.style);
                                }
                                let coords = eval(data.COORDS);
                                cfgs['lng']=coords[0];
                                cfgs['lat']=coords[1];
                                cfgs['text']=data.ADDRESS;

                                addMarksV2(cfgs);
                            });
                        });
                        break;
                    case '4':
                        this.carourselData(body);
                    default:break;
                }
                this.drawer =false;
            },
            carourselHeatMap:function(body){
                this.cleanMapData();
                let style = body.style;
                if(typeof(style) == "string"){
                    style = JSON.parse(body.style);
                }
                if(style.carouselColType && style.carouselColType=='1'){
                    let dataIndex=0;
                    this.loopHeatMap = setInterval(loopShowHotMapFn,2000);
                    function loopShowHotMapFn(){
                        let heatDatas = body.heatData;
                        showHotMap(heatDatas[dataIndex]);
                        dataIndex++;
                        if(dataIndex==heatDatas.length){
                            dataIndex=0;
                        }
                    }
                }else{
                    loopShowHotMap(body.heatData);
                }
            },
            cleanMapData:function(){
                cleanMarks();
                cleanMarks(true);
                this.cleanLoopHearMap();
                this.closeCarourse();
            },
            cleanLoopHearMap:function(){
                if(this.loopHeatMap){
                    clearInterval(this.loopHeatMap);
                    this.loopHeatMap = undefined;
                }
                removeHotMap();
            },
            carourselData:function(body){
                this.cleanMapData();
                if(!body){
                    return;
                }
                if(body.length){
                    body.forEach(item=>{
                        let cfgs = item.style;
                        if(typeof(cfgs)=='string'){
                            cfgs = JSON.parse(item.style);
                        }
                        let datas = item.data;
                        datas.forEach(data=>{
                            let coords = eval(data.COORDS);
                            cfgs['lng']=coords[0];
                            cfgs['lat']=coords[1];
                            cfgs['text']=data.ADDRESS;
                            addMarksV2(cfgs);
                        });
                    });
                    return;
                }
                if(!body.data || body.data.length==0){
                    return;
                }

                let bodyData = body.data;
                let group=[];
                for(let p in bodyData){
                    group.push(p);
                }
                let i=0;
                this.timer = setInterval(carourselFn,2000);
                function carourselFn(){
                    cleanMarks(true);
                    let el = group[i];
                    let data = bodyData[el]||[];
                    data.forEach(item=>{
                        let itemData = item.data;
                        let cfgs = item.style;
                        if(typeof(item.style)=='string'){
                            cfgs = JSON.parse(item.style);
                        }
                        itemData.forEach(sItem=>{
                            let coords = eval(sItem.COORDS);
                            cfgs['lng']=coords[0];
                            cfgs['lat']=coords[1];
                            cfgs['text']=''+sItem.VAL;
                            cfgs.radius=sItem.VAL;
                            addCarouselMarks(cfgs);
                        });
                    });
                    console.info(i);
                    if(i==group.length-1){
                        i=0;
                    }else{
                        i++
                    }
                }
            },
            closeCarourse:function(){
                clearInterval(this.timer);
                this.timer = undefined;
            },
            submitDialogForm:function(formName) {
                this.$refs[formName].validate((valid) => {
                    if(valid){
                        this.saveDialogData(this.modifyIndex);
                        this.dialogDatabing = false;
                    }else{
                        return false;
                    }
                })
            },
            iconChangeData:function(index){
                let item = this.iconList[index];
                this.formMarks.iconName = item.iconName;
                this.formMarks.iconType = item.iconType;
            },
            loadIconData:function(method,api,data){
                let me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200'){
                        me.iconList= json.body||[];
                    }
                });
            },
            doSaveCoordData:function(){
                let me = this;
                let jsonDataList = this.rquestParams('POST',configpre.api_rootPath+'map/testAddCoords.html',this.formTest);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200'){
                        me.myMessage('保存成功','success');
                    }
                });
            },
            choiceModelClick:function(){
                if(this.choiceModelData==''){
                    this.myMessage('请选择数据模型','warnning');
                    return;
                }
                this.modelDataChoice = !this.modelDataChoice;
            },
            loadModel:function(method,api,data){
                const me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200'){
                        me.models =json.body || [];
                        me.totalCount = json.totalCount;
                    }
                });
            },
            handleCurrentChange(val) {
                this.loadModel('POST',configpre.api_loadModels,{pageSize: this.pageSize, pageNo: val || 1});
            },
            dealModelData: function (flag, item, event, pageNo) {
                this.choiceModelData = item;
                if (event) {
                    var el = event.currentTarget;
                    $('#datamodeltable tr').removeClass('row_background');
                    $(el).addClass('row_background');
                }
                this.choiceModelName = '已选中模型:'+item.CN_NAME;
                let data = {
                    tableName:item.EN_NAME
                }
                this.loadModelRelationData('POST',configpre.map_loadModelRelation,data);
            },

            handleSelectionChange:function(rows){
                this.colDatas = [];
                rows.forEach(row=>{
                    this.colDatas.push(row.REGION);
                });
            },
            handleFloatSelectionChange:function(rows){
                this.saveFloatData = rows;
            },
            changeRegion:function(colName){
                if(!this.modelRadio || this.modelRadio=='' || !this.modelRadioEnName || this.modelRadioEnName==''){
                    this.myMessage('请选择数据模型','warnning');
                    return;
                }
                let data = {
                    modelId:this.modelRadio,
                    tableName:this.modelRadioEnName,
                    colName:colName
                };
                this.loadTableDataGroupByCol('POST',configpre.map_loadTableDataGroupByCol,data);
                delete data.colName;
                data['mapType'] = this.formMarks.dataType;
                this.loadModelStyle('POST',configpre.map_loadModelStyle,data);
            },
            changeCoordCol:function(colName){
                if(!this.modelRadio || this.modelRadio=='' || !this.modelRadioEnName || this.modelRadioEnName==''){
                    this.myMessage('请选择数据模型','warnning');
                    return;
                }
                if(this.formMarks.dataType=='3'){
                    let data = {
                        modelId:this.modelRadio,
                        tableName:this.modelRadioEnName,
                        coords:colName
                    };
                    this.loadFloatData('POST',configpre.map_loadModelDataFloat,data);
                }
            },
            loadTableDataGroupByCol:function(method,api,data){
                const me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200' && json.body){
                        if(json.body){
                            me.tableDatas = json.body||[];
                        }else{
                            this.myMessage('无数据','success');
                        }
                    }else{
                        this.myMessage('系统异常，请联系管理员','error');
                    }
                });
            },
            loadModelStyle:function(method,api,data){
                const me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200' && json.body){
                        if(json.body){
                            me.styleDatas = json.body||'';
                        }
                    }
                });
            },

            openSetStyleDialg:function(opt,row){
                let style;
                if(opt=='single'){
                    this.colDatas = [];
                    if(this.styleDatas!=''){
                        this.colDatas.push(row.REGION);
                        let key = this.formMarks.addressCol+'-'+row.REGION;
                        style = this.styleDatas[key];
                        if(typeof(style) == 'string'){
                            style = JSON.parse(style);
                        }
                    }
                }else{
                    if(this.colDatas.length==0){
                        this.myMessage('请勾选数据','warning');
                        return;
                    }
                }
                this.initStyle(style);
                this.loadIconData('POST',configpre.map_getGisIcon);
                this.innerVisible = true;
            },
            saveStyleData:function(){
                let params=[];
                this.colDatas.forEach(colData=>{
                    let cfgs = {
                        modelId:this.modelRadio,
                        tableName:this.modelRadioEnName,
                        colName:this.formMarks.addressCol,
                        colData:colData,
                        mapType:this.formMarks.dataType,
                        status:'1'
                    };
                    let style ={
                        styleType:this.formMarks.styleType,
                        status:this.formMarks.status,
                        iconStatus:this.formMarks.iconStatus,
                        opacity:this.formMarks.opacity,
                        iconData:this.formMarks.iconData,
                        iconName:this.formMarks.iconName,
                        iconType:this.formMarks.iconType,
                        radius:this.formMarks.radius,
                        imageColor:this.formMarks.imageColor,
                        textAlign:this.formMarks.textAlign,
                        textBaseline:this.formMarks.textBaseline,
                        font:this.formMarks.font,
                        text:colData,
                        textFillColor:this.formMarks.textFillColor,
                        textStrokeColor:this.formMarks.textStrokeColor,
                        textStrokeWidth:this.formMarks.textStrokeWidth
                    };
                    cfgs['styleData'] = style;
                    params.push(cfgs);
                });

                if(params.length>0){
                    const me = this;
                    let jsonDataList = this.rquestParams('POST',configpre.map_saveModelStyle,{data:params});
                    ajaxrequestasync(jsonDataList,function(code,msg,json){
                        if(code=='200'){
                            me.innerVisible = false;
                            params.forEach(item=>{
                                let key = me.formMarks.addressCol+'-'+item.colData;
                                me.styleDatas[key] = item.styleData;
                            });
                            me.initStyle();
                            me.myMessage('保存成功','success');
                        }else{
                            me.myMessage('系统异常，请联系管理员','error');
                        }
                    });
                }
            },
            initStyle:function(style){
                if(style){
                   for(let p in style){
                       this.formMarks[p] = style[p];
                   }
                }else{
                    this.formMarks.styleType=0;
                    this.formMarks.status='1';
                    this.formMarks.iconStatus=0;
                    this.formMarks.opacity=0.7;
                    this.formMarks.iconData='';
                    this.formMarks.iconName='';
                    this.formMarks.iconType='';
                    this.formMarks.radius=4;
                    this.formMarks.imageColor='#3392F4';
                    this.formMarks.textAlign='center';
                    this.formMarks.textBaseline='middle';
                    this.formMarks.font='normal 14px 微软雅黑';
                    this.formMarks.text='';
                    this.formMarks.textFillColor='#FDF9FE';
                    this.formMarks.textStrokeColor='#ffcc33';
                    this.formMarks.textStrokeWidth=2;
                }
            },
            openSetFloatDialog:function(){
                this.saveFloatData=[];
                if(this.formMarks.coordCol==''){
                    this.myMessage('请绑定地理位置','warning');
                }else{
                    this.innerFloatVisible = true;
                }

            },
            loadFloatData:function(method,api,data){
                const me = this;
                let jsonDataList = this.rquestParams(method,api,data);
                ajaxrequestasync(jsonDataList,function(code,msg,json){
                    if(code=='200'){
                        debugger;
                        me.floatData = json.body||[];
                        let allCols = me.dimensionColList.concat(me.metricColList);
                        let newFloatData = [];
                        allCols.forEach(item=>{
                            let cfg = {
                                colName:item.COLUMN_NAME,
                                COLUMN_RENAME:item.COLUMN_RENAME,
                                dataLable:'',
                                groupBy:'0',
                            };
                            me.floatData.forEach(el=>{
                                if(el.COL_NAME==item.COLUMN_NAME){
                                    cfg.dataLable = el.DATA_LABLE;
                                    cfg.groupBy = el.GROUP_BY;
                                    cfg['orderNum'] = el.ORDER_NUM;
                                }
                            });
                            newFloatData.push(cfg);
                        });
                        me.floatData = newFloatData;

                    }else{
                        me.myMessage('加载悬浮框数据异常','error');
                    }
                });
            },
            doSaveModelDataFloat:function(){
                if(this.saveFloatData.length>0){
                    let cfgs = {
                        modelId:this.modelRadio,
                        tableName:this.modelRadioEnName,
                        coords:this.formMarks.coordCol,
                        status:'1',
                        data:this.saveFloatData
                    }
                    const me = this;
                    let jsonDataList = this.rquestParams('POST',configpre.map_saveModelDataFloat,cfgs);
                    ajaxrequestasync(jsonDataList,function(code,msg,json){
                        if(code=='200'){
                            me.innerFloatVisible = false;
                            me.myMessage('保存成功','success');
                        }else{
                            me.myMessage('系统异常，请联系管理员','error');
                        }
                    });
                }else{
                    this.myMessage('请勾选数据','success');
                }

            }
        }
    });

</script>
</body>
</html>